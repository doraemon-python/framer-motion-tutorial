# Framer Motionの仕様をまとめ、検証するリポジトリ
## 最高にiPhoneみたいなUIを作ろう！

最初はframer-motionのチュートリアルに従い、framer-motionの機能をまとめていました。(最後に目次あり)その中で、Layoutの機能がiOSの動作を再現するに向いていると感じたので、iOSのようなUIをJavaScriptで実現してみました。もっとiOSに似たUIを作れるかたはぜひプルリクエストをください！

> 使用技術は`Next.js`, `TailWindCSS`, `Framer Motion`です。

### 動作を見てみる

```
git clone https://github.com/doraemon-python/framer-motion-tutorial.git
cd framer-motion-tutorial
npm i
npm run dev
```
上のコマンドを打ち`http://localhost:3000/layout/ios`にアクセスまたは[こちら](https://iridescent-daffodil-144897.netlify.app/layout/ios)にアクセス(このリンクは変更させることがあります。)

###  UIの動作の説明

1. アプリを開くと、
   - メインのアプリ群が小さくなる
   - 下のアプリ群が下に動く
   - 画面全体に黒いフィルターがかかる
   - フィルターの上でアプリが拡大し全画面になる

   が同時に起こります。
1. アプリを閉じると、
   - メインのアプリ群が小さい状態から元に戻る
   - 下のアプリ群が少し上から元の位置に戻る
   - アプリ画面が元の大きさに戻る

   が同時に起こります。

なお、アプリ画面及びアイコンは真っ白な`div`タグと重なっており、起動時はアイコンが薄くなってだんだん見えなくなり、終了時はアイコンが真っ白の状態からだんだん見えてくるようにしています。

### コンポーネントの説明

このUIに必要なコンポーネントファイルは
- /components/home.js

ページファイルは
- /pages/layout/ios/index.js
- /pages/layout/ios/[appname].js

です。

1.コンポーネント構造
- `<Home />`
   - `<TopBar />` --- 時計、ダイナミックアイランド、Wi-Fiなどの表示部分
   - `<MainIcons />` --- ボトムバーを除くアプリおよびウィジェット
   - `<BottomBar />` --- 画面下部のアプリ群
   - `<BgFilter />` --- 背景を黒くするフィルター

`<MainIcons />`と`<BottomBar />`はCSS gridを用いており、アプリは 1 * 1, ウィジェットは 2 * 2の大きさです。

1. アプリのコンポーネント
   - `<TopIcon />` --- `<MainIcons />`に用いられるアプリアイコンで、アプリ名がアイコンの下についています。
   - `<BottomIcon />` --- `<BottomBar />`に用いられるアプリアイコンで、アプリ名がありません。
   
   また、この二つは`<BaseIcon />`を子要素に持ちます。

1. ウィジェットのコンポーネント
   - `<WidgetWeather />` --- 天気アプリ専用のウィジェットです。
   - `<WidgetPhotos />` --- 写真アプリ専用のウィジェットです。
   
   また、この二つは`<BaseWidget />`を子要素に持ちます。

1. アニメーションを実現するコンポーネント
   
   `<BaseIcon />`と`<BaseWidget />`は`<AnimationSquare />`を子要素に持ちます。これは上記の拡大、縮小、真っ白状態との相互遷移を実現するための正方形のコンポーネントです。さらにこれは、`<SquareContainer />`を子要素に持ちます。これは、`padding-top: 100%;`を用いて、正方形の要素を作るためのコンポーネントです。

### アニメーションの仕組み
`/layout/ios/`は`<Home />`のみを出力します。各アプリ、ウィジェットはそれぞれの`layoutId`を持っています。

ユーザが`/layout/ios/photos/`(例)にアクセスすると、真っ白な`<div>`タグと`<DummyHome />`が返されます。`<DummyHome />`は`<div>`タグのしたにあり見えませんが、アイコンが拡大中の時に一部見えるのでおいています。`<div>`タグに`layoutId`を設定している一方、`<DummyHome />`は`<Home />`と見た目は同じでも、各アイコンは`layoutId`を持たないため、適切にアイコンの拡大、縮小の描画ができます。`<AnimationSquare />`はアイコンと真っ白の要素が重なっており、ホーム画面ではアイコンが、起動画面では白い背景のみが見えます。互いに`opacity`を入れ替えることで自然な描画処理をしています。そのほか、`z-index`を調整しています。

### 現在の問題点
- アプリ画面を詳細に設定しても、起動、終了アニメーションでは真っ白な画面で代用せざるを得ない。
- アプリ終了アニメーション時にz-indexの関係から、黒いフィルターを間にかますことができない。
- アプリ終了アニメーション時に、一瞬ホーム画面の他のアイコンが白画面の上に見えることがある。

### 今後実装したい機能
- コントロールメニューの設定
- アプリの作りこみ
- 画面を下にスワイプすることでアプリ終了

### 他のファイル構造
チュートリアルで紹介された順にその機能を実装しています。
- normal --- 基本的なアニメーションの定義方法
- variant --- 変数を使ったアニメーション
- gesture --- タップやホバーした時のアニメーション
- drag --- ドラッグ機能のあるアニメーション
- scroll --- 画面内に入ったときの処理
- exit --- `<AnimationPresence />`を使ったアンマウント時の処理
- layout --- `layout`機能を使ったアニメーション。この中にiOSのようなアニメーションあり
- tmp --- 一時的に実験するためのページ